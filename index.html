<!DOCTYPE html>

<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>arcLed</title>
    <style>
        body {
            margin: 0;
            padding: 60px;
            background: linear-gradient(135deg, #1e1e1e, #2a2a2a);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }

```
    .device-container {
        position: relative;
        width: 400px;
        height: 400px;
        margin: auto;
        transition: transform 0.5s ease;
        transform: rotate(280deg);
        /* 回転の中心を明確に中央に設定 */
        transform-origin: 200px 200px;
    }

    .device {
        position: absolute;
        top: 50px;
        left: 50px;
        width: 300px;
        height: 300px;
        background: radial-gradient(circle, #1a1a1a, #000);
        border-radius: 50%;
        box-shadow: 
            0 0 30px rgba(0,0,0,0.8),
            inset 0 0 20px rgba(255,255,255,0.1),
            0 10px 30px rgba(0,0,0,0.6);
        border: 3px solid #333;
    }

    .led {
        position: absolute;
        width: 8px;
        height: 25px;
        border-radius: 2px;
        background: #222;
        border: 1px solid #444;
        transition: all 0.3s ease;
        transform-origin: center center;
    }

    .led::before {
        content: '';
        position: absolute;
        top: -5px;
        left: -2px;
        width: 12px;
        height: 35px;
        border-radius: 3px;
        background: transparent;
        transition: all 0.3s ease;
    }

    .led::after {
        content: '';
        position: absolute;
        top: 2px;
        left: 1px;
        width: 6px;
        height: 21px;
        border-radius: 1px;
        background: #333;
        transition: all 0.3s ease;
    }

    .led.active {
        background: currentColor;
        border-color: currentColor;
        box-shadow: 
            0 0 20px currentColor,
            0 0 35px currentColor,
            inset 0 0 8px rgba(255,255,255,0.3);
    }

    .led.active::before {
        background: currentColor;
        opacity: 0.3;
        box-shadow: 
            0 0 25px currentColor,
            0 0 40px currentColor;
    }

    .led.active::after {
        background: currentColor;
        box-shadow: 
            0 0 10px currentColor,
            inset 0 0 5px rgba(255,255,255,0.5);
    }

    .led.red { color: #ff4444; }
    .led.orange { color: #ff8800; }
    .led.yellow { color: #ffdd00; }
    .led.green { color: #44ff44; }
    .led.blue { color: #4488ff; }
    .led.purple { color: #aa44ff; }

    .start-button {
        position: absolute;
        top: 53%;
        left: 30px;
        transform: translateY(-50%);
        width: 70px;
        height: 70px;
        border-radius: 50%;
        background: linear-gradient(145deg, #2a2a2a, #111);
        border: 4px solid #444;
        color: #fff;
        font-size: 10px;
        font-weight: bold;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        transition: all 0.3s ease;
        box-shadow: 
            0 8px 20px rgba(0,0,0,0.7),
            inset 0 3px 8px rgba(255,255,255,0.15),
            0 0 0 2px rgba(0,255,136,0.2);
        user-select: none;
        backdrop-filter: blur(5px);
    }

    .start-button:hover {
        background: linear-gradient(145deg, #333, #1a1a1a);
        box-shadow: 
            0 6px 15px rgba(0,0,0,0.8),
            inset 0 3px 8px rgba(255,255,255,0.2),
            0 0 0 2px rgba(0,255,136,0.4);
        transform: translateY(-50%) translateX(3px);
    }

    .start-button:active {
        transform: translateY(-50%) scale(0.95);
    }

    .start-button:disabled {
        cursor: not-allowed;
        opacity: 0.6;
    }

    .press-indicator {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80px;
        height: 80px;
        border-radius: 50%;
        border: 3px solid #333;
        background: rgba(0,0,0,0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .press-indicator.show {
        opacity: 1;
    }

    .progress-ring {
        position: absolute;
        width: 70px;
        height: 70px;
        transform: rotate(-90deg);
    }

    .progress-ring-bg {
        fill: none;
        stroke: #333;
        stroke-width: 4;
    }

    .progress-ring-fill {
        fill: none;
        stroke: #00ff88;
        stroke-width: 4;
        stroke-linecap: round;
        stroke-dasharray: 201.06;
        stroke-dashoffset: 201.06;
        transition: stroke-dashoffset 3s linear;
        filter: drop-shadow(0 0 8px #00ff88);
    }

    .press-indicator.pressing .progress-ring-fill {
        stroke-dashoffset: 0;
    }

    .inner-glow {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 140px;
        height: 140px;
        transform: translate(-50%, -50%);
        border-radius: 50%;
        background: radial-gradient(circle, transparent 60%, rgba(0,0,0,0.3) 100%);
        pointer-events: none;
        transition: all 0.5s ease;
    }

    .device.has-active-leds .inner-glow {
        background: radial-gradient(circle, rgba(68, 255, 68, 0.1) 0%, transparent 70%);
    }

    .mode-switch {
        position: fixed;
        top: 20px;
        left: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
        color: #fff;
        font-size: 11px;
        font-weight: bold;
        background: rgba(0,0,0,0.85);
        padding: 6px 10px;
        border-radius: 20px;
        border: 2px solid #444;
        backdrop-filter: blur(10px);
        box-shadow: 
            0 4px 12px rgba(0,0,0,0.7),
            inset 0 1px 3px rgba(255,255,255,0.15);
        z-index: 1000;
    }

    .mode-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #666;
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 
            0 1px 3px rgba(0, 0, 0, 0.3),
            inset 0 1px 1px rgba(255, 255, 255, 0.1);
    }

    .mode-indicator.demo {
        background: #4488ff;
        box-shadow: 
            0 0 8px rgba(68,136,255,0.5),
            0 1px 3px rgba(0, 0, 0, 0.3),
            inset 0 1px 1px rgba(255, 255, 255, 0.2);
    }

    .mode-indicator.random {
        background: #ff8800;
        box-shadow: 
            0 0 8px rgba(255,136,0,0.5),
            0 1px 3px rgba(0, 0, 0, 0.3),
            inset 0 1px 1px rgba(255, 255, 255, 0.2);
    }

    .switch {
        position: relative;
        width: 50px;
        height: 25px;
        background: linear-gradient(145deg, #333, #111);
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid #555;
        box-shadow: inset 0 2px 5px rgba(0,0,0,0.3);
    }

    .switch.active {
        background: linear-gradient(145deg, #00cc77, #009955);
        border-color: #00ff88;
        box-shadow: 
            inset 0 2px 5px rgba(0,0,0,0.2),
            0 0 15px rgba(0,255,136,0.3);
    }

    .switch-handle {
        position: absolute;
        top: 2px;
        left: 2px;
        width: 19px;
        height: 19px;
        background: linear-gradient(145deg, #fff, #e0e0e0);
        border-radius: 50%;
        transition: all 0.3s ease;
        box-shadow: 
            0 2px 6px rgba(0,0,0,0.4),
            inset 0 1px 2px rgba(255,255,255,0.8);
    }

    .switch.active .switch-handle {
        transform: translateX(23px);
        background: linear-gradient(145deg, #fff, #f0f0f0);
    }

    /* 隠し回転ボタン */
    #rotation-button {
        position: fixed;
        bottom: 25px;
        right: 25px;
        width: 20px;
        height: 20px;
        background: rgba(255, 255, 255, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.4);
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.2s ease;
        z-index: 1000;
        backdrop-filter: blur(5px);
    }

    #rotation-button:hover {
        background: rgba(255, 255, 255, 0.5);
        border-color: rgba(255, 255, 255, 0.6);
        transform: scale(1.2);
    }

    #rotation-button:active {
        transform: scale(0.9);
        background: rgba(255, 255, 255, 0.7);
    }

    #rotation-indicator { display: none; }
    .progress-info { display: none; }
    .mode-labels { display: none; }
    .reset-button { display: none; }
    .press-text { display: none; }
</style>
```

</head>
<body>
    <div class="device-container">
        <div class="device" id="device">
            <div class="inner-glow"></div>

```
        <div class="press-indicator" id="pressIndicator">
            <svg class="progress-ring">
                <circle class="progress-ring-bg" cx="35" cy="35" r="32"/>
                <circle class="progress-ring-fill" cx="35" cy="35" r="32"/>
            </svg>
        </div>

        <button class="start-button" id="startButton">
            ●
        </button>
    </div>
</div>

<!-- 切り替えスイッチ（画面左上固定） -->
<div class="mode-switch">
    <div class="mode-indicator" id="modeIndicator"></div>
    <div class="switch" id="modeSwitch">
        <div class="switch-handle"></div>
    </div>
</div>

<!-- 隠し回転ボタン（画面右下固定） -->
<div id="rotation-button" onclick="rotateScreen()"></div>

<script>
    class LEDSequence {
        constructor() {
            this.colors = ['red', 'orange', 'yellow', 'green', 'blue', 'purple'];
            this.colorNames = ['赤', 'オレンジ', '黄色', '緑', '青', '紫'];
            this.leds = [];
            this.currentIndex = 0;
            this.isRunning = false;
            this.intervalId = null;
            this.pressTimer = null;
            this.isPressing = false;
            this.isRandomMode = false;
            this.startButton = document.getElementById('startButton');
            this.modeSwitch = document.getElementById('modeSwitch');
            this.modeIndicator = document.getElementById('modeIndicator');
            this.pressIndicator = document.getElementById('pressIndicator');
            this.device = document.getElementById('device');
            this.init();
        }

        init() {
            this.createLEDs();
            this.startButton.addEventListener('mousedown', (e) => this.startPress(e));
            this.startButton.addEventListener('mouseup', (e) => this.endPress(e));
            this.startButton.addEventListener('mouseleave', (e) => this.endPress(e));
            this.startButton.addEventListener('touchstart', (e) => this.startPress(e));
            this.startButton.addEventListener('touchend', (e) => this.endPress(e));
            this.startButton.addEventListener('touchcancel', (e) => this.endPress(e));
            this.modeSwitch.addEventListener('click', () => this.toggleMode());
            this.updateModeIndicator();
        }

        createLEDs() {
            const radius = 115;
            const centerX = 150;
            const centerY = 150;
            const startAngle = 225;
            const totalAngle = 270;
            const angleStep = totalAngle / 18;
            
            for (let i = 0; i < 18; i++) {
                const angle = startAngle + (i * angleStep);
                const colorIndex = Math.floor(i / 3);
                const color = this.colors[colorIndex];
                const led = document.createElement('div');
                led.className = `led ${color}`;
                const radians = (angle * Math.PI) / 180;
                const x = centerX + radius * Math.cos(radians) - 4;
                const y = centerY + radius * Math.sin(radians) - 12;
                led.style.left = x + 'px';
                led.style.top = y + 'px';
                const rotation = angle + 180;
                led.style.transform = `rotate(${rotation}deg)`;
                this.device.appendChild(led);
                this.leds.push(led);
            }
        }

        toggleMode() {
            this.isRandomMode = !this.isRandomMode;
            if (this.isRandomMode) {
                this.modeSwitch.classList.add('active');
            } else {
                this.modeSwitch.classList.remove('active');
            }
            this.updateModeIndicator();
        }

        updateModeIndicator() {
            this.modeIndicator.className = 'mode-indicator';
            if (this.isRandomMode) {
                this.modeIndicator.classList.add('random');
            } else {
                this.modeIndicator.classList.add('demo');
            }
        }

        startPress(e) {
            e.preventDefault();
            if (this.isPressing) return;
            if (this.isRunning || this.currentIndex > 0) {
                this.reset();
                return;
            }
            this.isPressing = true;
            this.pressIndicator.classList.add('show', 'pressing');
            this.startButton.style.background = 'linear-gradient(145deg, #00aa66, #006644)';
            this.pressTimer = setTimeout(() => {
                this.start();
            }, 3000);
        }

        endPress(e) {
            e.preventDefault();
            if (!this.isPressing) return;
            this.isPressing = false;
            this.pressIndicator.classList.remove('show', 'pressing');
            this.startButton.style.background = '';
            if (this.pressTimer) {
                clearTimeout(this.pressTimer);
                this.pressTimer = null;
            }
        }

        start() {
            if (this.isRunning) return;
            this.isRunning = true;
            this.isPressing = false;
            this.pressIndicator.classList.remove('show', 'pressing');
            this.startButton.disabled = true;
            this.startButton.style.background = '';
            this.startSequence();
        }

        startSequence() {
            let targetIndex = 18;
            if (this.isRandomMode) {
                targetIndex = Math.floor(Math.random() * 18) + 1;
            }
            this.intervalId = setInterval(() => {
                if (this.currentIndex < targetIndex) {
                    this.leds[this.currentIndex].classList.add('active');
                    this.device.classList.add('has-active-leds');
                    this.currentIndex++;
                    if (this.currentIndex >= targetIndex) {
                        this.completeSequence();
                    }
                }
            }, 300);
        }

        completeSequence() {
            clearInterval(this.intervalId);
            this.isRunning = false;
            this.startButton.disabled = false;
            this.showThinkingEffect();
        }

        showThinkingEffect() {
            let cycleCount = 0;
            const maxCycles = 3;
            let currentLed = 0;
            
            this.leds.forEach(led => {
                led.classList.remove('active');
                led.style.opacity = '0.3';
            });

            const thinkingInterval = setInterval(() => {
                if (currentLed > 0) {
                    this.leds[currentLed - 1].style.opacity = '0.3';
                } else if (currentLed === 0 && cycleCount > 0) {
                    this.leds[17].style.opacity = '0.3';
                }
                
                this.leds[currentLed].style.opacity = '1';
                this.leds[currentLed].classList.add('active');
                currentLed++;
                
                if (currentLed >= 18) {
                    currentLed = 0;
                    cycleCount++;
                    this.leds[17].style.opacity = '0.3';
                    if (cycleCount >= maxCycles) {
                        clearInterval(thinkingInterval);
                        this.showFinalResult();
                    }
                }
            }, 100);
        }

        showFinalResult() {
            this.leds.forEach(led => {
                led.classList.remove('active');
                led.style.opacity = '1';
                led.style.animation = '';
            });

            let targetIndex = this.currentIndex;
            if (this.isRandomMode && this.currentIndex > 0) {
                const finalColorIndex = Math.floor((this.currentIndex - 1) / 3);
                if (finalColorIndex <= 1) {
                    this.showReturnEffect(targetIndex);
                    return;
                }
            }
            this.showNormalResult(targetIndex);
        }

        showReturnEffect(finalTarget) {
            let currentIndex = 0;
            const orangeEnd = 8;
            
            const forwardInterval = setInterval(() => {
                this.leds[currentIndex].classList.add('active');
                currentIndex++;
                if (currentIndex > orangeEnd) {
                    clearInterval(forwardInterval);
                    setTimeout(() => {
                        this.showReturnAnimation(orangeEnd, finalTarget);
                    }, 500);
                }
            }, 150);
        }

        showReturnAnimation(startIndex, finalTarget) {
            let currentIndex = startIndex;
            
            const returnInterval = setInterval(() => {
                if (currentIndex >= finalTarget) {
                    this.leds[currentIndex].classList.remove('active');
                    currentIndex--;
                }
                if (currentIndex < finalTarget) {
                    clearInterval(returnInterval);
                    this.blinkResult();
                }
            }, 150);
        }

        showNormalResult(targetIndex) {
            let currentIndex = 0;
            
            const resultInterval = setInterval(() => {
                this.leds[currentIndex].classList.add('active');
                currentIndex++;
                if (currentIndex >= targetIndex) {
                    clearInterval(resultInterval);
                    setTimeout(() => {
                        this.blinkResult();
                    }, 300);
                }
            }, 200);
        }

        blinkResult() {
            let blinkCount = 0;
            const maxBlinks = 3;
            
            const blinkInterval = setInterval(() => {
                const activeLeds = this.leds.filter(led => led.classList.contains('active'));
                
                if (blinkCount % 2 === 0) {
                    activeLeds.forEach(led => {
                        led.style.opacity = '0.3';
                    });
                } else {
                    activeLeds.forEach(led => {
                        led.style.opacity = '1';
                    });
                }
                
                blinkCount++;
                if (blinkCount >= maxBlinks * 2) {
                    clearInterval(blinkInterval);
                    activeLeds.forEach(led => {
                        led.style.opacity = '1';
                        led.style.animation = 'pulse 2s ease-in-out infinite';
                    });
                }
            }, 400);
        }

        reset() {
            if (this.isRunning) {
                clearInterval(this.intervalId);
                this.isRunning = false;
            }
            if (this.isPressing) {
                this.endPress({preventDefault: () => {}});
            }
            this.currentIndex = 0;
            this.startButton.disabled = false;
            this.startButton.style.background = '';
            this.device.classList.remove('has-active-leds');
            this.leds.forEach(led => {
                led.classList.remove('active');
                led.style.animation = '';
                led.style.opacity = '1';
            });
        }
    }

    // 回転機能
    let deviceRotation = 280;

    function rotateScreen() {
        deviceRotation += 90;
        if (deviceRotation >= 360) {
            deviceRotation = 0;
        }
        
        const deviceContainer = document.querySelector('.device-container');
        deviceContainer.style.transform = `rotate(${deviceRotation}deg)`;
        
        const rotationButton = document.getElementById('rotation-button');
        rotationButton.style.background = 'rgba(255, 255, 255, 0.8)';
        rotationButton.style.borderColor = 'rgba(255, 255, 255, 0.9)';
        rotationButton.style.transform = 'scale(1.3)';
        
        setTimeout(() => {
            rotationButton.style.background = 'rgba(255, 255, 255, 0.3)';
            rotationButton.style.borderColor = 'rgba(255, 255, 255, 0.4)';
            rotationButton.style.transform = 'scale(1)';
        }, 200);
        
        console.log(`デバイスを${deviceRotation}度回転しました`);
    }

    // キーボードショートカット
    document.addEventListener('keydown', function(event) {
        switch(event.key.toLowerCase()) {
            case ' ':
                event.preventDefault();
                rotateScreen();
                break;
            case 'escape':
                if (window.ledSequence) {
                    window.ledSequence.reset();
                }
                break;
        }
    });

    window.addEventListener('DOMContentLoaded', () => {
        window.ledSequence = new LEDSequence();
    });

    const style = document.createElement('style');
    style.textContent = `
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    `;
    document.head.appendChild(style);
</script>
```

</body>
</html>
